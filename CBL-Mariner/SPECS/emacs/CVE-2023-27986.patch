This patch is a merge of the fixes for CVE-2023-27985 and CVE-2023-27986

from the upstream Emacs repository:
- CVE-2023-27985
  author	Ulrich Müller <ulm@gentoo.org>	2022-12-19 16:51:20 +0100
  committer	Eli Zaretskii <eliz@gnu.org>	2022-12-24 09:19:40 +0200
  commit	d32091199ae5de590a83f1542a01d75fba000467 (patch)
  tree	36116fc8020e9b1bb28d062e946f346dc2a4e51b

- CVE-2023-27986
  author	Ulrich Müller <ulm@gentoo.org>	2023-03-07 18:25:37 +0100
  committer	Ulrich Müller <ulm@gentoo.org>	2023-03-07 18:25:37 +0100
  commit	3c1693d08b0a71d40a77e7b40c0ebc42dca2d2cc (patch)
  tree	f4d2798e2e502999a8c06062bdda0f8498fa6afa

---

diff -ru emacs-28.2-orig/etc/emacsclient.desktop emacs-28.2/etc/emacsclient.desktop
--- emacs-28.2-orig/etc/emacsclient.desktop	2023-03-16 10:26:16.800255062 -0700
+++ emacs-28.2/etc/emacsclient.desktop	2023-03-16 10:39:49.479611186 -0700
@@ -3,7 +3,7 @@
 GenericName=Text Editor
 Comment=Edit text
 MimeType=text/english;text/plain;text/x-makefile;text/x-c++hdr;text/x-c++src;text/x-chdr;text/x-csrc;text/x-java;text/x-moc;text/x-pascal;text/x-tcl;text/x-tex;application/x-shellscript;text/x-c;text/x-c++;
-Exec=sh -c "if [ -n \\"\\$*\\" ]; then exec emacsclient --alternate-editor= --display=\\"\\$DISPLAY\\" \\"\\$@\\"; else exec emacsclient --alternate-editor= --create-frame; fi" placeholder %F
+Exec=sh -c "if [ -n \\"\\$*\\" ]; then exec emacsclient --alternate-editor= --display=\\"\\$DISPLAY\\" \\"\\$@\\"; else exec emacsclient --alternate-editor= --create-frame; fi" sh %F
 Icon=emacs
 Type=Application
 Terminal=false
diff -ru emacs-28.2-orig/etc/emacsclient-mail.desktop emacs-28.2/etc/emacsclient-mail.desktop
--- emacs-28.2-orig/etc/emacsclient-mail.desktop	2023-03-16 10:26:16.800255062 -0700
+++ emacs-28.2/etc/emacsclient-mail.desktop	2023-03-16 10:41:07.359580131 -0700
@@ -1,7 +1,10 @@
 [Desktop Entry]
 Categories=Network;Email;
 Comment=GNU Emacs is an extensible, customizable text editor - and more
-Exec=sh -c "exec emacsclient --alternate-editor= --display=\\"\\$DISPLAY\\" --eval \\\\(message-mailto\\\\ \\\\\\"%u\\\\\\"\\\\)"
+# We want to pass the following commands to the shell wrapper:
+# u=${1//\\/\\\\}; u=${u//\"/\\\"}; exec emacsclient --alternate-editor= --display="$DISPLAY" --eval "(message-mailto \"$u\")"
+# Special chars '"', '$', and '\' must be escaped as '\\"', '\\$', and '\\\\'.
+Exec=bash -c "u=\\${1//\\\\\\\\/\\\\\\\\\\\\\\\\}; u=\\${u//\\\\\\"/\\\\\\\\\\\\\\"}; exec emacsclient --alternate-editor= --display=\\"\\$DISPLAY\\" --eval \\"(message-mailto \\\\\\"\\$u\\\\\\")\\"" bash %u
 Icon=emacs
 Name=Emacs (Mail, Client)
 MimeType=x-scheme-handler/mailto;
@@ -13,7 +16,7 @@
 
 [Desktop Action new-window]
 Name=New Window
-Exec=emacsclient --alternate-editor= --create-frame --eval "(message-mailto \\"%u\\")"
+Exec=bash -c "u=\\${1//\\\\\\\\/\\\\\\\\\\\\\\\\}; u=\\${u//\\\\\\"/\\\\\\\\\\\\\\"}; exec emacsclient --alternate-editor= --create-frame --eval \\"(message-mailto \\\\\\"\\$u\\\\\\")\\"" bash %u
 
 [Desktop Action new-instance]
 Name=New Instance
